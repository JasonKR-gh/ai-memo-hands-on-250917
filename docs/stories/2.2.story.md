# Story 2.2: 노트 목록 조회 및 페이지네이션

## Status

Done

## Story

**As a** 로그인한 사용자,
**I want** 내가 작성한 노트들의 목록을 조회하고 페이지네이션을 통해 탐색할 수 있는 기능,
**so that** 저장된 노트들을 효율적으로 찾고 관리할 수 있다.

## Acceptance Criteria

1. 대시보드에서 "내 노트" 섹션에 노트 목록이 표시되어야 한다
2. 각 노트 항목에는 제목, 작성일, 수정일이 표시되어야 한다
3. 노트 제목을 클릭하면 해당 노트의 상세 페이지로 이동해야 한다
4. 노트 목록은 최신순으로 정렬되어야 한다
5. 한 페이지에 최대 10개의 노트가 표시되어야 한다
6. 페이지네이션 버튼을 통해 이전/다음 페이지로 이동할 수 있어야 한다
7. 현재 페이지 번호와 전체 페이지 수가 표시되어야 한다
8. 노트가 없는 경우 "아직 노트가 없습니다" 메시지가 표시되어야 한다
9. 노트 목록 로딩 중에는 로딩 스피너가 표시되어야 한다
10. 노트 목록 조회 실패 시 적절한 에러 메시지가 표시되어야 한다

## Tasks / Subtasks

- [x] 노트 목록 조회 API 구현 (AC: 1, 2, 4, 5)
  - [x] 노트 목록 조회 Server Action 구현
  - [x] 페이지네이션 로직 구현 (offset, limit)
  - [x] 사용자별 노트 필터링 (RLS 정책 활용)
  - [x] 최신순 정렬 쿼리 구현
- [x] 노트 목록 UI 컴포넌트 구현 (AC: 1, 2, 3, 8, 9)
  - [x] 노트 목록 카드 컴포넌트 생성
  - [x] 노트 제목, 작성일, 수정일 표시
  - [x] 노트 제목 클릭 시 상세 페이지 이동
  - [x] 빈 상태 UI 구현 ("아직 노트가 없습니다")
  - [x] 로딩 스피너 컴포넌트 구현
- [x] 페이지네이션 컴포넌트 구현 (AC: 6, 7)
  - [x] 이전/다음 버튼 구현
  - [x] 페이지 번호 표시
  - [x] 현재 페이지 하이라이트
  - [x] 페이지 변경 시 URL 업데이트
- [x] 대시보드 페이지 업데이트 (AC: 1)
  - [x] 노트 목록 섹션 추가
  - [x] 기존 "새 노트 작성" 버튼과 통합
- [x] 에러 핸들링 구현 (AC: 10)
  - [x] 노트 목록 조회 실패 시 에러 메시지 표시
  - [x] 네트워크 오류 처리
  - [x] 사용자 친화적 에러 UI

## Dev Notes

### 이전 스토리 인사이트

[Source: Story 2.1 Dev Agent Record]

- ✅ Drizzle ORM 설정 및 노트 스키마 완료
- ✅ 노트 생성 기능 구현 완료
- ✅ Server Actions 패턴 확립
- ✅ shadcn/ui 컴포넌트 시스템 활용 경험
- ✅ RLS 정책 설정으로 사용자별 데이터 격리 완료

### 데이터 모델 정보

[Source: docs/architecture.md#2-데이터-모델]

**notes 테이블 구조:**
- id (uuid, primary key)
- user_id (uuid, not null) - 사용자 식별
- title (text, not null, default: '제목 없음')
- content (text)
- created_at (timestamp with timezone)
- updated_at (timestamp with timezone)

### 보안 요구사항

[Source: docs/architecture.md#3-보안]

- **권한 스코프**: 사용자 ID 스코프로 소유자만 CRUD 가능
- **RLS 정책**: 이미 설정됨 (Story 2.1에서 완료)
- **서버 전용 키**: Supabase 서비스 롤 키는 서버에서만 사용

### Drizzle ORM 쿼리 패턴

[Source: Story 2.1 Dev Notes]

**노트 목록 조회 쿼리 예시:**
```typescript
// lib/notes/queries.ts
export async function getNotesByUserId(
  userId: string, 
  page: number = 1, 
  limit: number = 10
) {
  const offset = (page - 1) * limit;
  
  return await db
    .select()
    .from(notes)
    .where(eq(notes.userId, userId))
    .orderBy(desc(notes.updatedAt))
    .limit(limit)
    .offset(offset);
}
```

### 프로젝트 구조

[Source: Story 2.1 File List]

**기존 파일 구조:**
- `lib/db/schema/notes.ts` - 노트 스키마 정의
- `lib/notes/actions.ts` - 노트 관련 Server Actions
- `components/notes/note-form.tsx` - 노트 작성 폼

**새로 생성할 파일:**
- `lib/notes/queries.ts` - 노트 조회 쿼리 함수들
- `components/notes/note-list.tsx` - 노트 목록 컴포넌트
- `components/notes/note-card.tsx` - 개별 노트 카드 컴포넌트
- `components/ui/pagination.tsx` - 페이지네이션 컴포넌트
- `components/ui/loading-spinner.tsx` - 로딩 스피너 컴포넌트

### UI 컴포넌트 재사용

[Source: Story 2.1 Dev Notes]

**기존 shadcn/ui 컴포넌트:**
- `components/ui/button.tsx` - 페이지네이션 버튼
- `components/ui/card.tsx` - 노트 카드 컨테이너
- `components/ui/label.tsx` - 폼 레이블

**새로 필요한 컴포넌트:**
- `components/ui/pagination.tsx` - 페이지네이션 (shadcn/ui에서 설치)
- `components/ui/loading-spinner.tsx` - 로딩 스피너 (직접 구현)

### 페이지네이션 구현 전략

**URL 구조:**
- `/dashboard?page=1` - 첫 번째 페이지
- `/dashboard?page=2` - 두 번째 페이지

**상태 관리:**
- URL 쿼리 파라미터로 현재 페이지 관리
- `useSearchParams` 훅으로 페이지 상태 동기화

### 성능 최적화 고려사항

[Source: docs/architecture.md#6-배포운영]

- **페이지네이션**: 한 번에 10개씩만 로드하여 초기 로딩 시간 단축
- **인덱스 활용**: `user_id`, `updated_at` 컬럼에 인덱스 필요
- **캐싱**: Next.js의 자동 캐싱 활용

### Testing

#### 테스트 표준

[Source: docs/architecture.md#6-배포운영]

- 테스트 프레임워크: Jest + React Testing Library
- 테스트 파일 위치: `__tests__/` 또는 컴포넌트 옆에 `.test.tsx`

#### 노트 목록 테스트

- 노트 목록 렌더링 테스트
- 페이지네이션 동작 테스트
- 빈 상태 UI 테스트
- 로딩 상태 테스트
- 에러 핸들링 테스트
- 노트 카드 클릭 시 상세 페이지 이동 테스트

## Change Log

| Date       | Version | Description | Author           |
| ---------- | ------- | ----------- | ---------------- |
| 2025-01-27 | 1.0     | 스토리 생성 | Scrum Master Bob |
| 2025-01-27 | 1.1     | 구현 완료   | Dev Agent James  |

## Dev Agent Record

### Agent Model Used

Claude Sonnet 4

### Debug Log References

- Drizzle ORM 타입 오류 수정 완료 (Date | null 타입 처리)
- Suspense 경계 추가로 useSearchParams 오류 해결
- 모든 컴포넌트 및 페이지 구현 완료

### Completion Notes List

1. **노트 조회 API 구현**: lib/notes/queries.ts에 페이지네이션 지원 쿼리 함수 구현
2. **Server Action 추가**: lib/notes/actions.ts에 getNotesList 함수 추가
3. **UI 컴포넌트 구현**: 
   - LoadingSpinner 컴포넌트 (components/ui/loading-spinner.tsx)
   - Pagination 컴포넌트 (components/ui/pagination.tsx) - Suspense 경계 포함
   - NoteCard 컴포넌트 (components/notes/note-card.tsx)
   - NoteList 컴포넌트 (components/notes/note-list.tsx)
4. **대시보드 업데이트**: app/dashboard/page.tsx에 새로운 노트 목록 컴포넌트 통합
5. **노트 상세 페이지**: app/notes/[id]/page.tsx 생성 (AC 3번 충족)
6. **타입 안전성**: 모든 컴포넌트에서 null 허용 타입 처리

### File List

**새로 생성된 파일:**
- `lib/notes/queries.ts` - 노트 조회 쿼리 함수들
- `components/ui/loading-spinner.tsx` - 로딩 스피너 컴포넌트
- `components/ui/pagination.tsx` - 페이지네이션 컴포넌트
- `components/notes/note-card.tsx` - 개별 노트 카드 컴포넌트
- `components/notes/note-list.tsx` - 노트 목록 컴포넌트
- `app/notes/[id]/page.tsx` - 노트 상세 조회 페이지

**수정된 파일:**
- `lib/notes/actions.ts` - getNotesList Server Action 추가
- `app/dashboard/page.tsx` - 새로운 노트 목록 컴포넌트로 업데이트

## QA Results

*This section will be populated by the QA agent after implementation review*
