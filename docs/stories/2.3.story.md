# Story 2.3: 노트 상세 조회

## Status

Done

## Story

**As a** 로그인한 사용자,
**I want** 노트 목록에서 특정 노트를 클릭했을 때 해당 노트의 전체 내용을 상세히 볼 수 있는 기능,
**so that** 저장된 노트의 내용을 완전히 읽고 확인할 수 있다.

## Acceptance Criteria

1. 노트 목록에서 노트 제목을 클릭하면 해당 노트의 상세 페이지로 이동해야 한다
2. 노트 상세 페이지에는 제목, 본문, 작성일, 수정일이 모두 표시되어야 한다
3. 노트 상세 페이지에는 "수정" 버튼이 있어야 한다
4. 노트 상세 페이지에는 "삭제" 버튼이 있어야 한다
5. 노트 상세 페이지에는 "목록으로 돌아가기" 버튼이 있어야 한다
6. 존재하지 않는 노트 ID로 접근 시 404 에러 페이지가 표시되어야 한다
7. 다른 사용자의 노트에 접근 시 403 에러 또는 적절한 권한 없음 메시지가 표시되어야 한다
8. 노트 상세 페이지 로딩 중에는 로딩 스피너가 표시되어야 한다
9. 노트 상세 조회 실패 시 적절한 에러 메시지가 표시되어야 한다
10. 노트 상세 페이지는 반응형으로 모바일에서도 잘 보여야 한다

## Tasks / Subtasks

- [x] 노트 상세 조회 API 구현 (AC: 1, 2, 6, 7, 9)
  - [x] 노트 상세 조회 Server Action 구현
  - [x] 노트 ID로 단일 노트 조회 쿼리 구현
  - [x] 사용자 권한 검증 로직 구현 (RLS 정책 활용)
  - [x] 존재하지 않는 노트 처리 (404 에러)
  - [x] 권한 없는 노트 접근 처리 (403 에러)
- [x] 노트 상세 페이지 UI 구현 (AC: 2, 3, 4, 5, 8, 10)
  - [x] 노트 상세 페이지 컴포넌트 생성
  - [x] 노트 제목, 본문, 작성일, 수정일 표시
  - [x] "수정" 버튼 구현 (다음 스토리에서 연결)
  - [x] "삭제" 버튼 구현 (다음 스토리에서 연결)
  - [x] "목록으로 돌아가기" 버튼 구현
  - [x] 로딩 스피너 표시
  - [x] 반응형 레이아웃 구현
- [x] 에러 페이지 구현 (AC: 6, 7, 9)
  - [x] 404 에러 페이지 컴포넌트
  - [x] 403 권한 없음 에러 처리
  - [x] 일반적인 에러 메시지 표시
- [x] 라우팅 설정 (AC: 1)
  - [x] `/notes/[id]` 동적 라우트 설정
  - [x] URL 파라미터에서 노트 ID 추출
  - [x] 페이지 간 네비게이션 구현

## Dev Notes

### 이전 스토리 인사이트

[Source: Story 2.2 Dev Agent Record]

- ✅ 노트 목록 조회 및 페이지네이션 완료
- ✅ 노트 카드 클릭 시 상세 페이지 이동 기능 구현됨
- ✅ Drizzle ORM 쿼리 패턴 확립
- ✅ Server Actions 패턴 확립
- ✅ shadcn/ui 컴포넌트 시스템 활용 경험
- ✅ RLS 정책으로 사용자별 데이터 격리 완료

### 데이터 모델 정보

[Source: docs/architecture.md#2-데이터-모델]

**notes 테이블 구조:**
- id (uuid, primary key)
- user_id (uuid, not null) - 사용자 식별
- title (text, not null, default: '제목 없음')
- content (text)
- created_at (timestamp with timezone)
- updated_at (timestamp with timezone)

### 보안 요구사항

[Source: docs/architecture.md#3-보안]

- **권한 스코프**: 사용자 ID 스코프로 소유자만 CRUD 가능
- **RLS 정책**: 이미 설정됨 (Story 2.1에서 완료)
- **서버 전용 키**: Supabase 서비스 롤 키는 서버에서만 사용

### Drizzle ORM 쿼리 패턴

[Source: Story 2.2 Dev Notes]

**노트 상세 조회 쿼리 예시:**
```typescript
// lib/notes/queries.ts
export async function getNoteById(noteId: string, userId: string) {
  const result = await db
    .select()
    .from(notes)
    .where(and(eq(notes.id, noteId), eq(notes.userId, userId)))
    .limit(1);
  
  return result[0] || null;
}
```

### 프로젝트 구조

[Source: Story 2.2 File List]

**기존 파일 구조:**
- `lib/db/schema/notes.ts` - 노트 스키마 정의
- `lib/notes/actions.ts` - 노트 관련 Server Actions
- `lib/notes/queries.ts` - 노트 조회 쿼리 함수들
- `components/notes/note-card.tsx` - 노트 카드 컴포넌트

**새로 생성할 파일:**
- `app/notes/[id]/page.tsx` - 노트 상세 조회 페이지
- `components/notes/note-detail.tsx` - 노트 상세 컴포넌트
- `app/not-found.tsx` - 404 에러 페이지 (전역)
- `app/unauthorized.tsx` - 403 에러 페이지 (전역)

### UI 컴포넌트 재사용

[Source: Story 2.2 Dev Notes]

**기존 shadcn/ui 컴포넌트:**
- `components/ui/button.tsx` - 액션 버튼들
- `components/ui/card.tsx` - 노트 상세 컨테이너
- `components/ui/loading-spinner.tsx` - 로딩 스피너

**새로 필요한 컴포넌트:**
- `components/ui/alert.tsx` - 에러 메시지 표시 (shadcn/ui에서 설치)

### 라우팅 구조

**URL 구조:**
- `/notes/[id]` - 노트 상세 페이지 (동적 라우트)
- `/not-found` - 404 에러 페이지
- `/unauthorized` - 403 에러 페이지

**네비게이션:**
- 노트 카드 클릭 → `/notes/[id]` 이동
- "목록으로 돌아가기" → `/dashboard` 이동

### 에러 처리 전략

**에러 타입별 처리:**
1. **404 에러**: 존재하지 않는 노트 ID
2. **403 에러**: 권한 없는 노트 접근
3. **500 에러**: 서버 오류
4. **네트워크 에러**: 연결 실패

### 반응형 디자인

**브레이크포인트:**
- 모바일: 320px - 768px
- 태블릿: 768px - 1024px
- 데스크톱: 1024px+

**레이아웃 고려사항:**
- 노트 본문은 긴 텍스트를 고려한 스크롤 가능한 영역
- 버튼들은 모바일에서 터치하기 쉬운 크기로 배치

### Testing

#### 테스트 표준

[Source: docs/architecture.md#6-배포운영]

- 테스트 프레임워크: Jest + React Testing Library
- 테스트 파일 위치: `__tests__/` 또는 컴포넌트 옆에 `.test.tsx`

#### 노트 상세 조회 테스트

- 노트 상세 페이지 렌더링 테스트
- 노트 데이터 표시 테스트 (제목, 본문, 날짜)
- 404 에러 처리 테스트
- 403 권한 없음 에러 처리 테스트
- 로딩 상태 테스트
- 반응형 레이아웃 테스트
- 버튼 클릭 이벤트 테스트

## Change Log

| Date       | Version | Description | Author           |
| ---------- | ------- | ----------- | ---------------- |
| 2025-01-27 | 1.0     | 스토리 생성 | Scrum Master Bob |
| 2025-01-27 | 1.1     | 구현 완료   | Dev Agent James  |

## Dev Agent Record

### Agent Model Used

Claude Sonnet 4

### Debug Log References

- Drizzle ORM 쿼리 함수 추가 완료
- Server Action 에러 처리 로직 구현 완료
- 에러 페이지 컴포넌트 생성 완료 (클라이언트 컴포넌트로 수정)
- 노트 상세 컴포넌트 분리 완료
- Next.js 클라이언트/서버 컴포넌트 에러 수정 완료

### Completion Notes List

1. **노트 상세 조회 API 구현**: 
   - `lib/notes/queries.ts`에 `getNoteById` 함수 추가
   - `lib/notes/actions.ts`에 `getNoteDetail` Server Action 추가
   - 사용자 권한 검증 및 에러 코드 처리 구현

2. **에러 페이지 구현**:
   - `app/not-found.tsx` - 404 에러 페이지 생성 (클라이언트 컴포넌트)
   - `app/unauthorized.tsx` - 403 권한 없음 에러 페이지 생성 (클라이언트 컴포넌트)
   - 사용자 친화적인 에러 메시지 및 네비게이션 제공
   - Next.js 클라이언트/서버 컴포넌트 에러 수정

3. **노트 상세 페이지 개선**:
   - `app/notes/[id]/page.tsx` - 새로운 Server Action 사용하도록 수정
   - `components/notes/note-detail.tsx` - 재사용 가능한 노트 상세 컴포넌트 생성
   - `app/notes/[id]/loading.tsx` - 로딩 상태 UI 추가

4. **에러 처리 전략**:
   - 404 에러: 존재하지 않는 노트 ID
   - 403 에러: 권한 없는 노트 접근 (unauthorized 페이지로 리다이렉트)
   - 기타 에러: 404로 처리

5. **반응형 디자인**:
   - 모바일, 태블릿, 데스크톱 대응
   - 터치 친화적인 버튼 크기
   - 긴 텍스트를 위한 스크롤 가능한 영역

### File List

**새로 생성된 파일:**
- `app/not-found.tsx` - 404 에러 페이지
- `app/unauthorized.tsx` - 403 권한 없음 에러 페이지
- `components/notes/note-detail.tsx` - 노트 상세 컴포넌트
- `app/notes/[id]/loading.tsx` - 로딩 상태 UI

**수정된 파일:**
- `lib/notes/queries.ts` - getNoteById 쿼리 함수 추가
- `lib/notes/actions.ts` - getNoteDetail Server Action 추가
- `app/notes/[id]/page.tsx` - 새로운 Server Action 사용하도록 수정

## QA Results

*This section will be populated by the QA agent after implementation review*
